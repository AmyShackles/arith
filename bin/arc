#!/usr/bin/env node

const fs = require("fs");
const path = require("path");
const {
  tokenizeAndParseProgram,
} = require("../src/parse-and-evaluate");
const { transpileProgram } = require("../src/transpile");

const file = process.argv.slice(2)[0];
const lib = fs
  .readFileSync(path.join(__dirname, "../src/stdlib.js"), "utf-8")
  .split("module.exports")[0];

const input = fs.readFileSync(file, "utf-8");

const code = `${transpileProgram(tokenizeAndParseProgram(input))}\n`;
const newFile = `${file.split(".")[0]}.js`;

fs.writeFileSync(newFile, `${lib + code}`);
