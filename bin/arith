#!/usr/bin/env node

const fs = require("fs");
const chalk = require("chalk");
const {
  tokenizeAndParseProgram,
} = require("../src/parse-and-evaluate");
const { evaluateProgram } = require("../src/evaluate");

const run = (argv) => {
  const [command, ...args] = argv.slice(2);

  if (!command || command === "i") {
    const { repl } = require("../src/repl");
    repl();
  } else if (command.toLowerCase() === "help") {
    console.log(
      chalk.cyan(
        "Welcome to Arith - a simple, Lisp-like programming language.\n",
      ),
    );
    console.log(chalk.blue("Here are the valid commands:\n"));
    console.log("COMMAND", "                DESCRIPTION");
    console.log(
      "<none>, i",
      "              Open the interpreter in interactive/REPL mode",
    );
    console.log(
      "run",
      "                    Execute the contents of a valid Arith file",
    );
    console.log(); // blank line
    console.log(
      chalk.cyan(
        "Use the command 'arc <file>' to transpile its contents to JavaScript.\n",
      ),
    );
    console.log("Enjoy!");

    process.exit(0);
  } else if (command.toLowerCase() === "run") {
    const input = fs.readFileSync(args[0], "utf-8");

    console.log(evaluateProgram(tokenizeAndParseProgram(input)));
  }
};

run(process.argv);
